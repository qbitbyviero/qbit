<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Reuniones - FES Acatlán</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f9f9f9;
      padding: 20px;
      color: #333;
    }
    header {
      background-color: #002147;
      color: white;
      text-align: center;
      padding: 20px;
    }
    h1 {
      margin: 0;
      font-size: 24px;
    }
    .section {
      margin: 20px auto;
      max-width: 800px;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, textarea, select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      padding: 10px 20px;
      margin-top: 15px;
      font-size: 16px;
      background-color: #002147;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .asistente {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    .asistente input, .asistente select {
      flex: 1;
    }
    footer {
      text-align: center;
      margin-top: 40px;
      font-size: 12px;
      color: #aaa;
    }
    .controls {
      text-align: center;
      margin-top: 10px;
    }
    audio {
      display: block;
      margin: 10px auto;
    }
  </style>
</head>
<body>
  <header>
    <h1>Grabación y Registro de Reuniones</h1>
    <p>FES Acatlán - Sistema Institucional</p>
  </header>

  <div class="section">
    <h2>1. Grabación de Audio</h2>
    <div class="controls">
      <button id="startBtn">Iniciar Grabación</button>
      <button id="stopBtn" disabled>Detener Grabación</button>
      <button id="transcribeBtn">Transcribir</button>
      <p id="status"></p>
      <audio id="audioPlayer" controls></audio>
    </div>
  </div>

  <div class="section">
    <h2>2. Información de la Reunión</h2>
    <label>Tema:</label>
    <input id="tema" type="text">
    <label>Fecha:</label>
    <input id="fecha" type="date">
    <label>Hora:</label>
    <input id="hora" type="time">
    <label>Lugar:</label>
    <input id="lugar" type="text">
    <label>Observaciones:</label>
    <textarea id="observaciones"></textarea>
  </div>

  <div class="section asistentes">
    <h2>3. Asistentes</h2>
    <div id="listaAsistentes"></div>
    <button onclick="agregarAsistente()">Agregar Asistente</button>
  </div>

  <div class="section">
    <h2>4. Transcripción</h2>
    <textarea id="transcripcion" rows="10" placeholder="Aquí aparecerá la transcripción o puedes editarla antes de exportar"></textarea>
    <button onclick="generarPDF()">Guardar y Generar PDF</button>
  </div>

  <footer>
    Desarrollado por Francisco Javier Martínez Gutiérrez. Uso personal e institucional. Derechos de autor en trámite.
  </footer>

  <script>
    let mediaRecorder;
    let audioChunks = [];
    let allChunks = [];
    let chunkInterval;
    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");
    const status = document.getElementById("status");
    const audioPlayer = document.getElementById("audioPlayer");

    startBtn.onclick = async () => {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      audioChunks = [];
      allChunks = [];

      mediaRecorder.ondataavailable = e => {
        if (e.data.size > 0) {
          audioChunks.push(e.data);
        }
      };

      mediaRecorder.onstop = () => {
        clearInterval(chunkInterval);
        allChunks = allChunks.concat(audioChunks);
        const fullBlob = new Blob(allChunks, { type: 'audio/webm' });
        const url = URL.createObjectURL(fullBlob);
        audioPlayer.src = url;
      };

      mediaRecorder.start();
      status.textContent = "Grabando...";
      startBtn.disabled = true;
      stopBtn.disabled = false;

      chunkInterval = setInterval(() => {
        if (mediaRecorder.state === "recording") {
          mediaRecorder.requestData();
          allChunks = allChunks.concat(audioChunks);
          audioChunks = [];
        }
      }, 600000); // cada 10 minutos
    };

    stopBtn.onclick = () => {
      mediaRecorder.stop();
      status.textContent = "Grabación detenida.";
      startBtn.disabled = false;
      stopBtn.disabled = true;
    };

    document.getElementById("transcribeBtn").onclick = () => {
      alert("Función de transcripción aún en desarrollo");
    };

    function agregarAsistente() {
      const contenedor = document.getElementById("listaAsistentes");
      const fila = document.createElement("div");
      fila.className = "asistente";
      fila.innerHTML = `
        <select>
          <option value="">Prefijo</option>
          <option value="Mtro.">Mtro.</option>
          <option value="Dra.">Dra.</option>
          <option value="Dr.">Dr.</option>
          <option value="Lic.">Lic.</option>
        </select>
        <input type="text" placeholder="Nombre completo">
        <input type="email" placeholder="Correo electrónico">
      `;
      contenedor.appendChild(fila);
    }

    for (let i = 0; i < 6; i++) agregarAsistente();
  </script>
</body>
</html>
