<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agenda Posh Posh</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f2f2f2;
    }

    /* [SECCIÃ“N] ANIMACIÃ“N INICIAL */
    #splash {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background-color: black;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      animation: fadeOut 1s 3s forwards;
    }

    #splash img {
      width: 200px;
      animation: zoomIn 1.5s ease;
    }

    @keyframes zoomIn {
      0% { transform: scale(0); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes fadeOut {
      to { opacity: 0; visibility: hidden; }
    }

    /* [SECCIÃ“N] CITAS DEL DÃA */
    #daily-appointments {
      display: none;
      max-width: 800px;
      margin: 40px auto;
      background-color: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    #daily-appointments h2 {
      color: #333;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }

    #appointments-list {
      list-style: none;
      padding: 0;
    }

    #appointments-list li {
      padding: 12px;
      margin: 8px 0;
      background-color: #f9f9f9;
      border-radius: 8px;
      font-size: 16px;
    }

    .appointment-buttons {
      display: flex;
      gap: 15px;
      margin-top: 25px;
      justify-content: center;
    }

    .appointment-buttons button {
      padding: 12px 25px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }

    #print-btn {
      background-color: #4CAF50;
      color: white;
    }

    #show-btn {
      background-color: #2196F3;
      color: white;
    }

    #start-btn {
      background-color: #FF9800;
      color: white;
    }

    /* [SECCIÃ“N] CALENDARIO (se muestra despuÃ©s de "Comenzar") */
    #calendar-container {
      display: none;
    }

    /* Estilos existentes que se mantienen */
    header {
      background-color: #fff;
      padding: 10px 20px;
      display: flex;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      justify-content: space-between;
      flex-wrap: wrap;
    }

    header img {
      height: 40px;
    }

    header h1 {
      font-size: 20px;
      color: #333;
      margin: 0 15px;
      flex: 1;
    }

    nav ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
    }

    nav ul li {
      position: relative;
    }

    nav ul li a {
      display: block;
      padding: 10px 15px;
      color: #333;
      text-decoration: none;
      font-weight: bold;
      transition: background-color 0.3s;
    }

    nav ul li:hover > a {
      background-color: #e1f0ff;
    }

    nav ul li ul {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      background-color: #fff;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border-radius: 6px;
      z-index: 200;
    }

    nav ul li:hover ul {
      display: block;
    }

    nav ul li ul li a {
      padding: 10px 20px;
      white-space: nowrap;
    }

    #calendar {
    width: 100%;
    margin: 20px auto;
    background: white;
    padding: 20px;
    border-radius: 10px;
}

    /* ============= MODALES MEJORADOS ============= */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.75);
    backdrop-filter: blur(3px);
    overflow-y: auto;
    animation: fadeIn 0.3s ease-out;
}

.modal-content {
    background: linear-gradient(145deg, #ffffff, #f8f9fa);
    margin: 3% auto;
    padding: 25px;
    border-radius: 12px;
    width: 85%;
    max-width: 500px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.3);
    position: relative;
    max-height: 85vh;
    overflow-y: auto;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e9ecef;
}

.modal-title {
    color: #2c3e50;
    font-size: 1.5rem;
    margin: 0;
    font-weight: 600;
}

.close {
    color: #7f8c8d;
    font-size: 28px;
    font-weight: bold;
    transition: all 0.3s;
    line-height: 1;
}

.close:hover {
    color: #e74c3c;
    transform: scale(1.1);
}

/* Formulario mejorado */
.modal-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.form-group {
    margin-bottom: 5px;
}

label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #34495e;
    font-size: 0.95rem;
}

input, select {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #dfe6e9;
    border-radius: 8px;
    font-size: 1rem;
    transition: all 0.3s;
    background-color: #f8f9fa;
}

input:focus, select:focus {
    border-color: #3498db;
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    outline: none;
    background-color: #fff;
}

/* Botones mejorados */
.btn-container {
    display: flex;
    gap: 10px;
    margin-top: 20px;
    flex-wrap: wrap;
}

.btn {
    padding: 12px 20px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    flex: 1;
    min-width: 120px;
    text-align: center;
    border: none;
}

.btn-primary {
    background-color: #3498db;
    color: white;
}

.btn-primary:hover {
    background-color: #2980b9;
    transform: translateY(-2px);
}

.btn-secondary {
    background-color: #95a5a6;
    color: white;
}

.btn-secondary:hover {
    background-color: #7f8c8d;
}

/* Responsive */
@media (max-width: 768px) {
    .modal-content {
        width: 90%;
        margin: 10% auto;
        padding: 20px;
    }
    
    .btn {
        flex: 100%;
    }
}

@media (max-height: 600px) {
    .modal-content {
        max-height: 90vh;
        margin: 2% auto;
    }
}
nav {
  text-align: center;
  margin: 20px 0;
}

.menu-nav {
  list-style: none;
  padding: 0;
  margin: 0;
  display: inline-flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
}

.menu-nav > li {
  position: relative;
}

.menu-nav li a {
  display: inline-block;
  background: linear-gradient(135deg, #2AC3FF, #5af2ff);
  color: #0d2c3b;
  text-decoration: none;
  font-weight: bold;
  padding: 10px 20px;
  border-radius: 12px;
  transition: all 0.3s ease;
  font-size: 14px;
}

.menu-nav li a:hover {
  transform: translateY(-2px) scale(1.03);
  box-shadow: 0 8px 20px rgba(90, 242, 255, 0.4);
}

/* SubmenÃº */
.menu-nav .submenu {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  background: white;
  border-radius: 8px;
  padding: 0;
  list-style: none;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  z-index: 100;
  min-width: 160px;
}

.menu-nav .submenu li a {
  display: block;
  padding: 10px;
  border-radius: 0;
  background: none;
  color: #0d2c3b;
  font-size: 13px;
  font-weight: 500;
}

.menu-nav .submenu li a:hover {
  background: #e6f7ff;
}

/* Mostrar submenÃº al pasar el mouse */
.menu-nav .dropdown:hover .submenu {
  display: block;
}
  #modal-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.5);
    z-index: 999;
    justify-content: center;
    align-items: center;
  }

  #modal-overlay.activo {
    display: flex;
  }
  </style>
</head>
<body>

  <!-- [SECCIÃ“N] SPLASH SCREEN CON SONIDO -->
  <div id="splash">
    <img src="https://i.ibb.co/dF6tyVF/poshposh.jpg" alt="Logo Posh Posh">
    <audio id="barkSound" src="https://www.soundjay.com/mechanical/sounds/bark-01.mp3" preload="auto"></audio>
  </div>
  
  <!-- [SECCIÃ“N] CITAS DEL DÃA -->
  <div id="daily-appointments">
    <h2 id="current-date">ğŸ“… Cargando fecha...</h2>
    <ul id="appointments-list"></ul>
    <div class="appointment-buttons">
      <button id="print-btn" onclick="window.print()">ğŸ–¨ï¸ Imprimir</button>
      <button id="show-btn" onclick="mostrarCitasBonitas()">ğŸ‘ï¸ Mostrar</button>
      <button id="start-btn" onclick="comenzar()">ğŸš€ Comenzar</button>

    </div>
  </div>

  <!-- [SECCIÃ“N] CALENDARIO -->
  <div id="calendar-container">
    <header>
      <img src="https://i.ibb.co/dF6tyVF/poshposh.jpg" alt="Logo">
      <h1>Agenda Veterinaria - Posh Posh</h1>
      <nav>
        <ul class="menu-nav">
          <li class="dropdown">
            <a href="#">Cliente â¬‡</a>
            <ul class="submenu">
              <li><a href="#" onclick="abrirModal('modalNuevoCliente'); return false;">ğŸ¾ Nuevo</a></li>
              <li><a href="#" onclick="abrirModal('modalExistente'); return false;">ğŸ” Existente</a></li>
            </ul>
          </li>
      
          <li><a href="#" onclick="abrirModal('modalHistorial'); return false;">ğŸ“– Historial</a></li>
          <li><a href="#" onclick="abrirVacuna(); return false;">ğŸ’‰ Vacuna</a></li>
          <li><a href="#" onclick="abrirModal('tienda-section'); return false;">ğŸ›ï¸ Tienda</a></li>
          <li><a href="#" onclick="abrirEstetica(); return false;">âœ‚ï¸ EstÃ©tica</a></li>
        </ul>
      </nav>
    </header>
    <div id="calendar"></div>
  </div>
 <!-- Modal de Nuevo Cliente -->
<div id="modalNuevoCliente" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">Nuevo Cliente</h3>
      <span class="close" onclick="cerrarModal('modalNuevoCliente')">&times;</span>
    </div>
    <form id="formNuevoCliente" class="modal-form" onsubmit="return guardarCliente(event)">
      <div class="form-row">
        <div class="form-group">
          <label for="nombreDueno">Nombre del DueÃ±o</label>
          <input type="text" id="nombreDueno" required>
        </div>
        <div class="form-group">
          <label for="telefono">TelÃ©fono ğŸ“±</label>
          <input type="tel" id="telefono" required>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="direccion">DirecciÃ³n ğŸ“</label>
          <input type="text" id="direccion" required>
        </div>
        <div class="form-group">
          <label for="correo">Correo ğŸ“§</label>
          <input type="email" id="correo" required>
        </div>
      </div>
      
      <input type="hidden" id="idMascota">
      
      <div class="form-row">
        <div class="form-group">
          <label for="nombreMascota">Nombre de Mascota ğŸ¶/ğŸ±</label>
          <input type="text" id="nombreMascota" required>
        </div>
        <div class="form-group">
          <label for="edad">Edad ğŸ‚</label>
          <input type="number" id="edad" min="0" required>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="peso">Peso âš–ï¸ (kg)</label>
          <input type="number" id="peso" step="0.1" min="0" required>
        </div>
        <div class="form-group">
          <label for="sexo">Sexo</label>
          <select id="sexo" required>
            <option value="">Seleccionar...</option>
            <option value="Macho">Macho ğŸ’™</option>
            <option value="Hembra">Hembra â¤ï¸</option>
          </select>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="especieSelect">Especie ğŸ¦„</label>
          <select id="especieSelect" onchange="actualizarRazas()" required>
            <option value="">Seleccionar...</option>
            <option value="Perro">ğŸ¶ Perro</option>
            <option value="Gato">ğŸ± Gato</option>
            <option value="Conejo">ğŸ° Conejo</option>
            <option value="Ave">ğŸ¦œ Ave</option>
            <option value="HÃ¡mster">ğŸ¹ HÃ¡mster</option>
            <option value="Tortuga">ğŸ¢ Tortuga</option>
            <option value="Reptil">ğŸ¦ Reptil</option>
          </select>
        </div>
        <div class="form-group">
          <label for="raza">Raza ğŸ•/ğŸˆ</label>
          <select id="raza" required>
            <option value="">Seleccione especie primero</option>
          </select>
        </div>
      </div>
      
      <div class="btn-container">
        <button type="submit" class="btn btn-primary">Guardar</button>
        <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalNuevoCliente')">Cancelar</button>
      </div>
    </form>
  </div>
</div>
     <!-- Modal Cliente Existente -->
<div id="modalExistente" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">Buscar Cliente Existente</h3>
      <span class="close" onclick="cerrarModal('modalExistente')">&times;</span>
    </div>
    
    <div class="modal-form">
      <div class="form-group">
        <label>Buscar por:</label>
        <select id="tipoBusqueda">
          <option value="mascota">Nombre de mascota</option>
          <option value="dueno">Nombre del dueÃ±o</option>
          <option value="telefono">TelÃ©fono</option>
        </select>
      </div>
      
      <div class="form-group">
        <input type="text" id="terminoBusqueda" placeholder="Ej. Luna, Juan PÃ©rez, 5551234567">
      </div>
      
      <button class="btn btn-primary" onclick="buscarCliente()">ğŸ” Buscar</button>
      
      <div id="resultadosBusqueda" style="margin-top: 20px; display: none;">
        <h4>Resultados:</h4>
        <div id="listaClientes" style="max-height: 300px; overflow-y: auto;"></div>
      </div>
      
      <div class="btn-container" style="margin-top: 20px;">
        <button class="btn btn-secondary" onclick="cerrarModal('modalExistente')">Cancelar</button>
      </div>
    </div>
  </div>
</div>

  <!-- [SECCIÃ“N] SECCIONES PARA EL MENÃš -->
  <!-- Modal Historial -->
<div id="modalHistorial" class="modal">
  <div class="modal-content" style="max-width: 1000px;">
    <div class="modal-header">
      <h3 class="modal-title">ğŸ“‹ Historia ClÃ­nica Veterinaria</h3>
      <span class="close" onclick="cerrarModal('modalHistorial')">&times;</span>
    </div>
    
    <div class="modal-body">
      <div class="section-title">ğŸ“‘ InformaciÃ³n General</div>
      <div class="form-row">
        <div class="form-group">
          <label>NÃºmero Historia ClÃ­nica</label>
          <input type="text" name="num_historia">
        </div>
        <div class="form-group">
          <label>Fecha</label>
          <input type="date" name="fecha">
        </div>
        <div class="form-group">
          <label>Cliente ID</label>
          <input type="text" name="cliente_id">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Nombre DueÃ±o</label>
          <input type="text" name="nombre_dueno">
        </div>
        <div class="form-group">
          <label>DirecciÃ³n</label>
          <input type="text" name="direccion">
        </div>
        <div class="form-group">
          <label>TelÃ©fono</label>
          <input type="tel" name="telefono">
        </div>
        <div class="form-group">
          <label>Correo ElectrÃ³nico</label>
          <input type="email" name="correo">
        </div>
      </div>

      <div class="section-title">ğŸ¾ Datos de la Mascota</div>
      <div class="form-row">
        <div class="form-group">
          <label>Nombre Mascota</label>
          <input type="text" name="nombre_mascota">
        </div>
        <div class="form-group">
          <label>Especie</label>
          <select name="especie">
            <option value="">Seleccionar...</option>
            <option value="Perro">ğŸ¶ Perro</option>
            <option value="Gato">ğŸ± Gato</option>
            <option value="Conejo">ğŸ° Conejo</option>
            <option value="Ave">ğŸ¦œ Ave</option>
            <option value="HÃ¡mster">ğŸ¹ HÃ¡mster</option>
            <option value="Tortuga">ğŸ¢ Tortuga</option>
            <option value="Reptil">ğŸ¦ Reptil</option>
          </select>
        </div>
        <div class="form-group">
          <label>Raza</label>
          <input type="text" name="raza">
        </div>
        <div class="form-group">
          <label>Sexo</label>
          <select name="sexo">
            <option value="">Seleccionar...</option>
            <option value="Macho">Macho</option>
            <option value="Hembra">Hembra</option>
          </select>
        </div>
        <div class="form-group">
          <label>Edad</label>
          <input type="text" name="edad" placeholder="Ej. 2 aÃ±os">
        </div>
        <div class="form-group">
          <label>Peso (kg)</label>
          <input type="number" name="peso" step="0.1">
        </div>
      </div>

      <div class="section-title">ğŸ§¬ EvaluaciÃ³n ClÃ­nica</div>
      <div class="form-row">
        <div class="form-group">
          <label>Temperatura (Â°C)</label>
          <input type="number" name="temperatura" step="0.1">
        </div>
        <div class="form-group">
          <label>Pulso</label>
          <input type="number" name="pulso">
        </div>
        <div class="form-group">
          <label>Frecuencia CardÃ­aca</label>
          <input type="number" name="cardiaca">
        </div>
        <div class="form-group">
          <label>Frecuencia Respiratoria</label>
          <input type="number" name="respiratoria">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Estado General</label>
          <select name="estado_general">
            <option value="">Seleccionar...</option>
            <option value="Excelente">Excelente</option>
            <option value="Bueno">Bueno</option>
            <option value="Regular">Regular</option>
            <option value="Grave">Grave</option>
          </select>
        </div>
        <div class="form-group">
          <label>Tiempo de Llenado Capilar (seg)</label>
          <input type="number" name="capilar" step="0.1">
        </div>
        <div class="form-group">
          <label>Ojos</label>
          <input type="text" name="ojos" placeholder="Ej. Normal, secreciÃ³n">
        </div>
        <div class="form-group">
          <label>Tegumentario</label>
          <input type="text" name="tegumentario" placeholder="Ej. Piel normal">
        </div>
        <div class="form-group">
          <label>HidrataciÃ³n</label>
          <select name="hidratacion">
            <option value="">Seleccionar...</option>
            <option value="Normal">Normal</option>
            <option value="DeshidrataciÃ³n leve">DeshidrataciÃ³n leve</option>
            <option value="DeshidrataciÃ³n moderada">DeshidrataciÃ³n moderada</option>
            <option value="DeshidrataciÃ³n severa">DeshidrataciÃ³n severa</option>
          </select>
        </div>
      </div>

      <div class="section-title">ğŸ’Š DiagnÃ³stico & Tratamiento</div>
      <div class="form-row">
        <div class="form-group" style="flex: 1 1 100%;">
          <label>DiagnÃ³stico</label>
          <textarea name="diagnostico" rows="4"></textarea>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group" style="flex: 1 1 100%;">
          <label>Tratamiento</label>
          <textarea name="tratamiento" rows="4"></textarea>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group" style="flex: 1 1 100%;">
          <label>Observaciones</label>
          <textarea name="observaciones" rows="3"></textarea>
        </div>
      </div>

      <div class="section-title">ğŸ’° Costos</div>
      <div class="form-row">
        <div class="form-group" style="flex: 1 1 70%;">
          <label>Servicios Prestados</label>
          <textarea name="servicios" rows="3"></textarea>
        </div>
        <div class="form-group">
          <label>Costo Total ($)</label>
          <input type="number" name="costo_total" step="0.01">
        </div>
      </div>

      <div class="btn-container" style="margin-top: 30px;">
        <button type="button" class="btn btn-primary" onclick="guardarHistorial()">ğŸ’¾ Guardar</button>
        <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalHistorial')">âŒ Cerrar</button>
      </div>
    </div>
  </div>
</div>
<!-- Modal Vacunas -->
  <div id="vacuna-section" style="display:none; padding: 40px; max-width: 1000px; margin: 0 auto;">
    <h2>Registro de Vacunas</h2>
    <p>AquÃ­ irÃ¡ el contenido de vacunas...</p>
  </div>
<!-- Modal Tienda -->
<div id="tienda-section" class="modal">
  <div class="modal-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
  <!-- Estilos propios de la secciÃ³n Tienda -->
  <style>
    .selector-categorias {
      margin: 20px 0;
      padding: 12px 25px;
      border: 2px solid #2AC3FF;
      border-radius: 25px;
      background: white;
      font-size: 1.1em;
      width: 100%;
      max-width: 400px;
    }
    .categoria-section {
      margin: 30px 0;
      padding: 20px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 4px 15px rgba(42, 195, 255, 0.1);
    }
    .grid-productos {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      padding: 10px;
    }
    .producto-card {
      background: white;
      border-radius: 15px;
      padding: 15px;
      text-align: center;
      transition: all 0.3s ease;
      border: 1px solid #e3f2fd;
      position: relative;
      min-height: 250px;
    }
    .producto-imagen {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 12px;
      margin: 0 auto 10px;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
    }
    .badge-categoria {
      position: absolute;
      top: 10px;
      left: 10px;
      background: #5af2ff;
      padding: 4px 10px;
      border-radius: 15px;
      font-size: 0.8em;
      font-weight: bold;
    }
    .boton-agregar, .boton-guardar {
      cursor: pointer;
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      transition: all 0.2s;
    }
    .boton-agregar:hover, .boton-guardar:hover { transform: translateY(-2px); }
    .controles-venta {
      background: #fff;
      padding: 20px;
      border-radius: 15px;
      margin: 20px 0;
      box-shadow: 0 4px 10px rgba(42, 195, 255, 0.1);
    }
    .input-group { margin: 15px 0; }
    .input-group label { display: block; margin-bottom: 8px; color: #2a3f5f; font-weight: 500; }
    .input-group select,
    .input-group input,
    .input-group textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #2AC3FF;
      border-radius: 8px;
      font-family: 'Poppins', sans-serif;
    }
    @keyframes latido {
      0%,100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
  </style>

  <!-- Contenido -->
  <img src="https://i.ibb.co/dF6tyVF/poshposh.jpg" class="floating-logo" alt="Logo" style="height: 50px; display: block; margin: 0 auto 20px;">

  <div class="contenedor-principal">
    <div class="tarjeta-pos">
      <h1 class="titulo-modulo">ğŸ›’ Sistema POS Avanzado</h1>
      <div class="controles-venta">
        <div class="input-group">
          <label>ğŸ” Cliente:</label>
          <select id="selector-cliente">
            <option value="">Venta mostrador</option>
          </select>
        </div>
        <div class="input-group">
          <label>ğŸ’¸ MÃ©todo de pago:</label>
          <select id="metodo-pago">
            <option value="Efectivo">Efectivo</option>
            <option value="Tarjeta">Tarjeta</option>
            <option value="Transferencia">Transferencia</option>
          </select>
        </div>
        <div class="input-group">
          <label>ğŸ Tipo Descuento:</label>
          <select id="tipo-descuento">
            <option value="ninguno">Sin descuento</option>
            <option value="porcentaje">% Descuento</option>
            <option value="monto">Monto fijo (MXN)</option>
            <option value="promocion">PromociÃ³n</option>
            <option value="cliente-frecuente">Cliente frecuente</option>
          </select>
        </div>
        <div class="input-group">
          <label>ğŸ Valor Descuento:</label>
          <input type="number" id="valor-descuento" value="0" min="0" disabled>
        </div>
        <div class="input-group">
          <label>ğŸ“ Observaciones:</label>
          <textarea id="observaciones" rows="2"></textarea>
        </div>
      </div>

      <select id="selector-categoria" class="selector-categorias">
        <option value="todas">ğŸ“¦ Todas las categorÃ­as</option>
      </select>

      <div id="contenedor-categorias"></div>
    </div>
  </div>

  <!-- Carrito flotante -->
  <div class="carrito-flotante">
    <div class="carrito-header">
      <h3>ğŸ›’ Tu Carrito</h3>
      <span class="total-carrito">$0.00</span>
    </div>
    <div class="carrito-body" id="lista-carrito"></div>
    <div class="total-container">
      <p>Total: $<span id="total-venta">0.00</span></p>
      <button onclick="procesarVenta()" class="boton-guardar">âœ… Finalizar Venta</button>
    </div>
  </div>

  <!-- Scripts especÃ­ficos de tienda -->
  <script>
    let carrito = [], productos = [], categorias = [];

    function inicializarTienda() {
      // Clientes
      google.script.run.withSuccessHandler(cs => {
        const sel = document.getElementById('selector-cliente');
        cs.forEach(c => {
          const o = document.createElement('option');
          o.value = c.nombre;
          o.textContent = `${c.nombre} (${c.mascota})`;
          sel.appendChild(o);
        });
      }).obtenerClientes();

      // Productos
      google.script.run.withSuccessHandler(datos => {
        productos = datos.productos.filter(p => p.id);
        categorias = [...new Set(productos.map(p => p.categoria))];
        const selCat = document.getElementById('selector-categoria');
        categorias.forEach(cat => {
          selCat.innerHTML += `<option value="${cat}">${cat}</option>`;
        });
        mostrarProductos('todas');
      }).obtenerProductosPOS();
    }

    // Llamar una sola vez al abrir el modal
    document.getElementById('tienda-section').addEventListener('show', inicializarTienda);

    // ... y el resto de tus funciones: actualizarDescuento, mostrarProductos, filtrarProductos,
    // agregarAlCarrito, actualizarCantidad, actualizarCarrito, procesarVenta
    // (pÃ©galos exactamente como los tienes en tu tienda.html)
  </script>
</div>

<!-- Modal Estetica -->
  <div id="estetica-section" style="display:none; padding: 40px; max-width: 1000px; margin: 0 auto;">
    <h2>Servicios de EstÃ©tica</h2>
    <p>AquÃ­ irÃ¡ el contenido de estÃ©tica...</p>
  </div>
  <!-- MODAL NUEVA CITA -->
<div id="modalNuevaCita" class="modal">
  <div class="modal-content">
    <h3>ğŸ“… Agendar nueva cita</h3>

    <label>ğŸ¶ Nombre de la mascota:</label>
    <input type="text" id="mascotaInput" onblur="verificarMascotaExistente()" />

    <div id="preguntaDueno" style="display:none; margin-top: 8px;">
      <p>Â¿El dueÃ±o es <strong><span id="duenoSugerido"></span></strong>?</p>
      <button onclick="usarDuenoSugerido()">âœ… SÃ­</button>
      <button onclick="pedirNuevoDueno()">âŒ No</button>
    </div>

    <div id="campoNuevoDueno" style="display:none; margin-top: 10px;">
      <label>ğŸ‘¤ DueÃ±o:</label>
      <input type="text" id="duenoInput" />
    </div>

    <label>ğŸ“‹ Motivo:</label>
    <input type="text" id="motivoInput" />

    <label>ğŸ• Hora:</label>
    <input type="time" id="horaInput" />

    <label>ğŸ“Œ Estatus:</label>
    <select id="estatusInput">
      <option value="Activa">Activa</option>
      <option value="Cancelada">Cancelada</option>
    </select>

    <label>ğŸ“ Notas:</label>
    <textarea id="notasInput"></textarea>

    <label>ğŸ“· Foto:</label>
    <input type="file" id="fotoInput" accept="image/*" capture="environment" />

    <label>ğŸ’² Costo:</label>
    <input type="number" id="costoInput" />

    <div style="margin-top: 10px;">
      <button onclick="guardarNuevaCita()">ğŸ’¾ Guardar</button>
      <button onclick="cerrarModal('modalNuevaCita')">âŒ Cancelar</button>
    </div>
  </div>
</div>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script>
    const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbzf9DVM1u9egPIYgu6PuqvgTOKZOHuz5zoqCNOdM3BE7kKlVucxqDzP7oaV7jpNm4Zz/exec';
    let calendar;
    let citasPendientes = [];
    const razasPorEspecie = {
        'ğŸ¶ Perro': ['Labrador ğŸ¶', 'Pug ğŸ˜›', 'Chihuahua ğŸ’…', 'Pitbull ğŸ’ª'],
        'ğŸ± Gato': ['Persa ğŸ˜½', 'Siames ğŸ˜¸', 'Sphynx ğŸ±', 'Maine Coon ğŸ§¶'],
        'ğŸ° Conejo': ['Cabeza de leÃ³n ğŸ¦', 'Mini Lop ğŸ°', 'Angora âœ¨'],
        'ğŸ¦œ Ave': ['Periquito ğŸ¦', 'CacatÃºa ğŸµ', 'Loro ğŸ’š'],
        'ğŸ¹ HÃ¡mster': ['Sirio ğŸ§¡', 'Enano ruso â„ï¸', 'Roborovski âš¡'],
        'ğŸ¢ Tortuga': ['Tortuga de orejas rojas ğŸ¢', 'Tortuga rusa ğŸŒ¿'],
        'ğŸ¦ Reptil': ['Iguana ğŸ¦', 'Gecko ğŸŠ', 'CamaleÃ³n ğŸŒˆ']
    };

    // ========== FUNCIONES PRINCIPALES ==========
    async function initApp() {
        const barkSound = document.getElementById('barkSound');
        setTimeout(async () => {
            document.getElementById('splash').style.display = 'none';
            document.getElementById('daily-appointments').style.display = 'block';
            
            document.body.addEventListener('click', function playSoundOnce() {
                barkSound.play().catch(e => console.log('Sonido omitido'));
                document.body.removeEventListener('click', playSoundOnce);
            });
            
            await cargarCitasDelDia();
            setupMenuNavigation();
            actualizarRazas();
        }, 3000);
    }

    async function cargarCitasDelDia() {
  try {
    const hoy = new Date().toISOString().split('T')[0];
    const response = await fetch(`${WEBAPP_URL}?action=getCitas&fecha=${hoy}`);
    const citas = await response.json();
    const lista = document.getElementById('appointments-list');

    const opcionesFecha = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById('current-date').textContent =
      "ğŸ“… " + new Date().toLocaleDateString('es-MX', opcionesFecha);

    lista.innerHTML = citas.length ? '' : '<li>No hay citas programadas para hoy.</li>';

    citas.forEach(cita => {
      const mascota = cita['Paciente'] || '---';
      const dueno = cita['Cliente'] || '---';

      let hora = '---';
      if (cita['Hora']) {
        const valor = cita['Hora'];
        if (!isNaN(valor)) {
          const minutosTotales = Math.round(parseFloat(valor) * 24 * 60);
          const horas = Math.floor(minutosTotales / 60);
          const minutos = minutosTotales % 60;
          hora = `${horas.toString().padStart(2, '0')}:${minutos.toString().padStart(2, '0')}`;
        } else if (typeof valor === 'string') {
          const match = valor.match(/\d{1,2}:\d{2}/);
          hora = match ? match[0] : valor;
        }
      }

      const motivo = cita['Motivo'] || 'Sin motivo';

      const li = document.createElement('li');
      li.innerHTML = `
        ğŸ¶ <strong>${mascota}</strong> (DueÃ±o: ${dueno})<br>
        â° ${hora}<br>
        ğŸ“ ${motivo}
      `;
      lista.appendChild(li);
    });

    configurarBotones(); // si quieres que se activen los botones despuÃ©s de cargar las citas
  } catch (error) {
    console.error('Error:', error);
    document.getElementById('appointments-list').innerHTML = `
      <li style="color: red;">Error al cargar citas. Recarga la pÃ¡gina.</li>
    `;
  }
}

    function configurarBotones() {
        document.getElementById('print-btn').addEventListener('click', () => window.print());
        
        document.getElementById('show-btn').addEventListener('click', () => {
            const contenido = document.getElementById('daily-appointments').outerHTML;
            const ventana = window.open('', '_blank');
            ventana.document.write(`
                <html>
                    <head><title>Citas del DÃ­a - Posh Posh</title>
                    <style>${document.querySelector('style').innerHTML}</style></head>
                    <body>${contenido}</body>
                </html>
            `);
        });

        document.getElementById('start-btn').addEventListener('click', () => {
            document.getElementById('daily-appointments').style.display = 'none';
            document.getElementById('calendar-container').style.display = 'block';
            initCalendar();
        });
    }
    async function initCalendar() {
  const calendarEl = document.getElementById('calendar');
  document.getElementById('calendar-container').style.display = 'block';

  calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    locale: 'es',
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: 'dayGridMonth,timeGridWeek,timeGridDay'
    },
    height: 'auto',
    selectable: true,

    // âœ… CLICK EN UNA FECHA: ABRIR MODAL
    dateClick: (info) => {
      const hoy = new Date();
      hoy.setHours(0, 0, 0, 0);
      const seleccionada = new Date(info.dateStr);

      if (seleccionada < hoy) {
        mostrarAlerta('No puedes agendar una cita en una fecha pasada.', 'error');
        return;
      }

      // Guardamos la fecha seleccionada globalmente
      fechaSeleccionada = info.dateStr;

      // Abrir modal personalizado para nueva cita
      abrirModal('modalNuevaCita');
    },

    // âœ… CARGAR CITAS DESDE EL BACKEND
    events: async (fetchInfo, successCallback) => {
      try {
        const response = await fetch(`${WEBAPP_URL}?action=getCitas`);
        const citas = await response.json();

        const eventos = citas.map(cita => {
          const paciente = cita.Paciente || 'Mascota';
          const motivo = cita.Motivo || 'Sin motivo';
          const fecha = cita.Fecha || cita.fecha || '';

          return {
            title: `${paciente} - ${motivo}`,
            start: fecha,
            allDay: true,
            extendedProps: cita,
            color: getColorForAppointmentType(motivo)
          };
        });

        successCallback(eventos);
      } catch (error) {
        console.error('Error al cargar eventos del calendario:', error);
        mostrarAlerta('âŒ Error al cargar citas en el calendario', 'error');
      }
    }
  });

  calendar.render();
}
function getColorForAppointmentType(motivo) {
  const colors = {
    'Control de peso': '#4CAF50',
    'Consulta general': '#2196F3',
    'RevisiÃ³n': '#FFC107',
    'VacunaciÃ³n': '#9C27B0',
    'DesparasitaciÃ³n': '#795548'
  };
  return colors[motivo] || '#607D8B'; // Color por defecto
}

    function getColorForAppointmentType(motivo) {
        const colors = {
            'EstÃ©tica': '#FF9800',
            'Vacunas': '#4CAF50',
            'Consulta': '#2196F3',
            'Eutanasia': '#9C27B0',
            'CirugÃ­a': '#F44336'
        };
        return colors[motivo] || '#607D8B';
    }

    // ========== FUNCIONES DE CLIENTES ==========
    async function guardarCliente(event) {
  event.preventDefault();

  if (!validarFormulario()) return false;

  const formData = {
    nombreDueno: document.getElementById('nombreDueno').value.trim(),
    direccion: document.getElementById('direccion').value.trim(),
    telefono: document.getElementById('telefono').value.trim(),
    correo: document.getElementById('correo').value.trim(),
    nombreMascota: document.getElementById('nombreMascota').value.trim(),
    edad: document.getElementById('edad').value,
    peso: document.getElementById('peso').value,
    sexo: document.getElementById('sexo').value,
    especie: document.getElementById('especieSelect').value,
    raza: document.getElementById('raza').value
  };

  try {
    const existe = await verificarClienteExistente(formData.nombreDueno, formData.nombreMascota);
    if (existe.duenoYmascota) {
      mostrarAlerta('Â¡Este cliente y mascota ya estÃ¡n registrados!', 'error');
      return;
    }

    const response = await fetch(WEBAPP_URL, {
      method: 'POST',
      body: JSON.stringify({
        action: 'guardarCliente',
        ...formData // â† IMPORTANTE: aquÃ­ estÃ¡s mandando los datos planos como espera el GAS
      })
    });

    const result = await response.json();

    if (result.status === 'success') {
      mostrarAlerta('âœ… Registro exitoso!', 'success');
      cerrarModal('modalNuevoCliente');
      document.getElementById('formNuevoCliente').reset();
    } else {
      throw new Error(result.message || 'Fallo en el servidor');
    }
  } catch (error) {
    console.error('Error:', error);
    mostrarAlerta('âŒ Error al guardar: ' + error.message, 'error');
  }
}
    // ========== FUNCIONES AUXILIARES ==========
    function setupMenuNavigation() {
        document.querySelectorAll('nav a').forEach(link => {
            if (link.getAttribute('href').startsWith('#')) {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('href').substring(1);
                    document.querySelectorAll('[id$="-section"]').forEach(section => {
                        section.style.display = section.id === `${targetId}-section` ? 'block' : 'none';
                    });
                });
            }
        });
    }

    function abrirModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
    }

    function cerrarModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
    }

    function actualizarRazas() {
        const especie = document.getElementById('especieSelect').value;
        const razaSelect = document.getElementById('raza');
        razaSelect.innerHTML = '';

        if (razasPorEspecie[especie]) {
            razasPorEspecie[especie].forEach(raza => {
                const option = document.createElement('option');
                option.value = raza;
                option.textContent = raza;
                razaSelect.appendChild(option);
            });
        }
    }

    async function verificarClienteExistente(nombreDueno, nombreMascota) {
        const response = await fetch(`${WEBAPP_URL}?action=verificarCliente&nombreDueno=${encodeURIComponent(nombreDueno)}&nombreMascota=${encodeURIComponent(nombreMascota)}`);
        return await response.json();
    }

    async function generarNuevosIDs() {
        try {
            const response = await fetch(`${WEBAPP_URL}?action=generarIDs`);
            return await response.json();
        } catch (error) {
            return {
                idCliente: 'PP-' + Math.floor(1000 + Math.random() * 9000),
                idMascota: 'PP-' + Math.floor(1000 + Math.random() * 9000) + '-' + Math.floor(100 + Math.random() * 900)
            };
        }
    }

    async function guardarEnSpreadsheet(data) {
        try {
            await fetch(WEBAPP_URL, {
                method: 'POST',
                body: JSON.stringify({ action: 'guardarCliente', data })
            });
            return { ok: true };
        } catch (error) {
            console.error('Error:', error);
            return { ok: false };
        }
    }

    function validarFormulario() {
        const camposRequeridos = [
            'nombreDueno', 'direccion', 'telefono', 
            'correo', 'nombreMascota', 'edad', 'peso'
        ];
        
        for (const campoId of camposRequeridos) {
            const valor = document.getElementById(campoId).value.trim();
            if (!valor) {
                mostrarAlerta(`Complete el campo ${campoId.replace('nombre', '')}`, 'error');
                return false;
            }
        }
        
        const email = document.getElementById('correo').value;
        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            mostrarAlerta('Ingrese un correo vÃ¡lido', 'error');
            return false;
        }
        
        return true;
    }

    function mostrarAlerta(mensaje, tipo = 'info') {
        const colores = {
            success: '#4CAF50',
            error: '#F44336',
            info: '#2196F3'
        };
        
        Toastify({
            text: mensaje,
            duration: 3000,
            backgroundColor: colores[tipo],
            close: true,
            gravity: "top",
            position: "right"
        }).showToast();
    }

    // ========== INICIALIZACIÃ“N ==========
    document.addEventListener('DOMContentLoaded', initApp);
    window.addEventListener('click', (event) => {
        if (event.target.className === 'modal') {
            event.target.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
    });
    // ===========funcion para abrir las citas del dia========
    function mostrarCitasBonitas() {
  const lista = document.getElementById('appointments-list');
  const nuevaVentana = window.open('', '_blank');
  nuevaVentana.document.write(`
    <html>
      <head>
        <title>Citas del dÃ­a</title>
        <style>
          body { font-family: Arial; padding: 20px; }
          h2 { color: #444; }
          li { margin-bottom: 15px; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
        </style>
      </head>
      <body>
        <h2>Citas programadas para hoy</h2>
        <ul>${lista.innerHTML}</ul>
      </body>
    </html>
  `);
  nuevaVentana.document.close();
}
//======== Calendario ============
let calendarioInicializado = false;

function comenzar() {
  document.getElementById('daily-appointments').style.display = 'none';
  document.getElementById('calendar-container').style.display = 'block';

  if (!calendarioInicializado) {
    initCalendar();
    calendarioInicializado = true;
  }
}
let fechaSeleccionada = null;

// Mostrar modal con fecha seleccionada
function abrirModalNuevaCita(fecha) {
  fechaSeleccionada = fecha;
  document.getElementById('modalNuevaCita').style.display = 'block';
  document.body.style.overflow = 'hidden';
}

// Verificar si mascota ya existe
async function verificarMascotaExistente() {
  const nombreMascota = document.getElementById('mascotaInput').value.trim();
  if (!nombreMascota) return;

  const response = await fetch(`${WEBAPP_URL}?action=verificarMascota&nombreMascota=${encodeURIComponent(nombreMascota)}`);
  const resultado = await response.json();

  if (resultado.encontrado) {
    document.getElementById('duenoSugerido').textContent = resultado.dueno;
    document.getElementById('preguntaDueno').style.display = 'block';
  } else {
    document.getElementById('preguntaDueno').style.display = 'none';
    document.getElementById('campoNuevoDueno').style.display = 'block';
  }
}

function usarDuenoSugerido() {
  const sugerido = document.getElementById('duenoSugerido').textContent;
  document.getElementById('duenoInput').value = sugerido;
  document.getElementById('preguntaDueno').style.display = 'none';
  document.getElementById('campoNuevoDueno').style.display = 'none';
}

function pedirNuevoDueno() {
  document.getElementById('campoNuevoDueno').style.display = 'block';
  document.getElementById('preguntaDueno').style.display = 'none';
}

function cerrarModal(id) {
  document.getElementById(id).style.display = 'none';
  document.body.style.overflow = 'auto';
}

// Preparar y enviar datos de la cita
// ğŸ”„ Fragmento que sustituye la funciÃ³n guardarNuevaCita
async function guardarNuevaCita() {
  const cita = {
    fecha: fechaSeleccionada,
    hora: document.getElementById('horaInput').value,
    paciente: document.getElementById('mascotaInput').value,
    cliente: document.getElementById('duenoInput').value,
    motivo: document.getElementById('motivoInput').value,
    estatus: document.getElementById('estatusInput').value,
    notas: document.getElementById('notasInput').value,
    costo: document.getElementById('costoInput').value
  };

  try {
    const response = await fetch(WEBAPP_URL, {
      method: 'POST',
      body: JSON.stringify({
        action: 'guardarCitaAvanzada',
        ...cita
      })
    });

    const resultado = await response.json();

    if (resultado.status === 'success') {
      cerrarModal('modalNuevaCita');
      mostrarAlerta('ğŸ“Œ Cita guardada correctamente', 'success');
      calendar.refetchEvents();

      // Abrir ticket (usando GET)
      const ticketURL = `${WEBAPP_URL}?action=verTicket&paciente=${encodeURIComponent(cita.paciente)}&cliente=${encodeURIComponent(cita.cliente)}&motivo=${encodeURIComponent(cita.motivo)}&costo=${encodeURIComponent(cita.costo)}`;
      window.open(ticketURL, '_blank', 'width=400,height=600');

    } else {
      throw new Error(resultado.message || 'Error al guardar la cita');
    }
  } catch (error) {
    console.error('Error:', error);
    mostrarAlerta('âŒ Error al guardar la cita', 'error');
  }
}
// 1. FunciÃ³n para abrir el modal
function abrirHistorial() {
  document.getElementById('modalHistorial').style.display = 'block';
  document.body.style.overflow = 'hidden';
}

// 2. FunciÃ³n para guardar 
function guardarHistorial() {
  alert("ğŸ’¾ AquÃ­ conectarÃ¡s el guardado con la hoja 'Historial'");
}

// 3. AsegÃºrate que el botÃ³n de cierre llame a:
function cerrarModalHistorial() {
  document.getElementById('modalHistorial').style.display = 'none';
  document.body.style.overflow = 'auto';
}
function cerrarSecciones() {
  ['vacuna-section','tienda-section','estetica-section'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.display = 'none';
  });
  document.body.style.overflow = 'auto';
}

// Abre la secciÃ³n de vacunas
function abrirVacuna() {
  cerrarSecciones();
  const s = document.getElementById('vacuna-section');
  if (s) {
    s.style.display = 'block';
    document.body.style.overflow = 'hidden';
  }
}

// Abre la secciÃ³n de tienda
function abrirTienda() {
  abrirModal('tienda-section');
}

// Abre la secciÃ³n de estÃ©tica
function abrirEstetica() {
  cerrarSecciones();
  const s = document.getElementById('estetica-section');
  if (s) {
    s.style.display = 'block';
    document.body.style.overflow = 'hidden';
  }
}
</script>
</body>
</html>